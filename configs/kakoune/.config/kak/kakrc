source "%val{config}/plugins/plug.kak/rc/plug.kak"
plug "andreyorst/plug.kak" noload

plug DERPSQUID9/kakoune-cyberpunk-neon theme
plug yasukotelin/shirotelin theme
plug evanrelf/primer.kak theme
plug nesyamun/nord-kakoune theme
plug Icantjuddle/ayu-kak theme
plug caksoylar/kakoune-snow theme

colorscheme nord-light

plug h-youhei/kakoune-surround

set global grepcmd 'rg --column'

add-highlighter global/ number-lines
add-highlighter global/ show-matching

hook global InsertChar \t %{ exec -draft -itersel h@ }
set global tabstop 2
set global indentwidth 2

hook global KakBegin .* %{
  evaluate-commands %sh{
    if [ -e "$PWD/.git/tags" ]; then
      printf "%s\n" "set-option -add current ctagsfiles %{$PWD/.git/tags}"
    fi
  }
}

# Lint
hook global WinSetOption filetype=sh %{
  set-option window lintcmd "shellcheck -fgcc -Cnever"
}
hook global WinSetOption filetype=(markdown|plain) %{
  set-option window lintcmd "proselint"
}

# Automatic linting
hook global WinSetOption filetype=(sh|markdown|plain) %{
  hook buffer BufWritePost "\Q%val{buffile}" lint
}

# Format
# yarn global add prettier @prettier/plugin-ruby
hook global BufSetOption filetype=(javascript|ruby|css|scss|json) %{
  set-option buffer formatcmd "prettier --stdin-filepath=%val{buffile}"
}

def rspec \
  -override \
  -docstring "Run an rspec spec" \
  -params 1 \
  -shell-script-candidates %{ find spec/**/*_spec.rb } \
  %{
    terminal  sh -c "bundle exec rspec %arg{@} ;  read -n 1 -s -r -p 'Press any key to continue'"
  }
